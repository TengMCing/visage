<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>visage OOP system • visage</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="visage OOP system">
<meta property="og:description" content="visage">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">visage</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9008</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/visage-OOP.html">visage OOP system</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/TengMCing/visage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>visage OOP system</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TengMCing/visage/blob/HEAD/vignettes/visage-OOP.Rmd" class="external-link"><code>vignettes/visage-OOP.Rmd</code></a></small>
      <div class="hidden name"><code>visage-OOP.Rmd</code></div>

    </div>

    
    
<div class="section level1">
<h1 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h1>
<p><strong>OOP</strong> has been heavily used in R via the S3 system. However, users who have learned OOP in other languages are often dissatisfied with its syntax. This vignette introduces an OOP system provided by the <code>visage</code> package, which tries to implement a lightweight OOP system with python-like syntax in R using the “environment” language feature.</p>
<!-- This OOP system is developed primarily for the ease of designing, simulating, and evaluating visual inference experiment.  -->
<p>There is another OOP system in R called <a href="https://r6.r-lib.org/index.html" class="external-link">R6</a>, which is also implemented using environment but in a different way.</p>
</div>
<div class="section level1">
<h1 id="structure-of-this-vignette">Structure of this vignette<a class="anchor" aria-label="anchor" href="#structure-of-this-vignette"></a>
</h1>
<p>The first section will review some essential concepts of OOP, if you are familiar with them, you can safely skip it.</p>
</div>
<div class="section level1">
<h1 id="oop-concepts-review">OOP concepts review<a class="anchor" aria-label="anchor" href="#oop-concepts-review"></a>
</h1>
<p><strong>OOP</strong> stands for <strong>object-oriented programming</strong>, which is a programming paradigm based on <strong>objects</strong>. Usually, object is defined as a special type of data structure that can hold both <strong>attributes</strong> (data) and <strong>methods</strong> (associated behaviours).</p>
<div class="section level2">
<h2 id="class-and-instance">Class and instance<a class="anchor" aria-label="anchor" href="#class-and-instance"></a>
</h2>
<ul>
<li>Different kinds of objects are designed to belong to different <strong>classes</strong>.</li>
</ul>
<p>Data frame and list are designed to belong to two different S3 classes in R. This can be checked by using <code>class(data.frame())</code> and <code>class(list())</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "data.frame"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "list"</span></code></pre></div>
<p>However, if you call <code>unclass(data.frame())</code>, you will see that data frame is actually just a named list with some additional attributes, which means they are two of the similar kind.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; named list()</span>
<span class="co">#&gt; attr(,"row.names")</span>
<span class="co">#&gt; integer(0)</span></code></pre></div>
<p>So, why would they belong to different S3 classes? It is possibly because they are two different data structures and are expected to behave differently. Data frame is a two-dimensional-like structure, while list is a dynamic array-like data structure. In terms of the associated behaviours, one obvious example is data frame has the method <code>dim</code> to obtain the dimensions of the object, but list does not.</p>
<ul>
<li>Objects are <strong>instances</strong> of classes.</li>
</ul>
<p>Let <code>a &lt;- data.frame(b = 1)</code>, then <code>a</code> is an instance of class <code>data.frame</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">is</span><span class="op">(</span><span class="va">a</span>, <span class="st">"data.frame"</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Every instance has its own set of data and behaviours. Let <code>b &lt;- data.frame(a = 2, b = 2)</code>, then both <code>b</code> and <code>a</code> are instances of class <code>data.frame</code>, but they have different sets of data.</p>
</div>
<div class="section level2">
<h2 id="inheritance-and-composition">Inheritance and composition<a class="anchor" aria-label="anchor" href="#inheritance-and-composition"></a>
</h2>
<p>Though data frame and list are two different kinds of objects, they still have commonalities. In fact, the result of <code>extends("data.frame", "list")</code> shows that list is a super class of data frame (this is a bit controversial, see <a href="https://stackoverflow.com/questions/19607652/why-doesnt-classdata-frame-show-list-inheritance" class="external-link uri">https://stackoverflow.com/questions/19607652/why-doesnt-classdata-frame-show-list-inheritance</a>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">extends</span><span class="op">(</span><span class="st">"data.frame"</span>, <span class="st">"list"</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>In other words, data frame <strong>inherits</strong> from list in R.</p>
<ul>
<li>In OOP, <strong>Inheritance</strong> is probably the most famous and widely-used relationship. A class can inherit both attributes and methods from its parent class.</li>
</ul>
<p>This gives us the ability to define family tree like class system.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Suppose we need to design a simple management system for a company to record the salary of all employees, and provide mechanism to give pay raise. There are two kinds of staffs in this company, employee and manager. For manager, its team members also need to be recorded.</p>
<p>For this system, we could first define an <code>employee</code> class with two attributes <code>emp_id</code> (employee ID) and <code>salary</code>, and a method <code>pay_raise</code>, which could raise the salary of an employee by a certain amount.</p>
<p>Then, we need to define another class called <code>manager</code>. Note that managers are still employees, so we also need to keep track of their employee IDs and salary, and be able to give pay raise if needed. Therefore, it is clear that class <code>manager</code> needs to inherit from <code>employee</code>.</p>
<p>Finally, to keep track of a manager’s team members, a new attribute called <code>team_members</code> is needed, which could be a list of <code>employee</code> objects.</p>
<ul>
<li>The act of collecting several objects in one object is called <strong>composition</strong>.</li>
</ul>
<p>In this example, both inheritance and composition are used.</p>
</div>
</div>
<div class="section level2">
<h2 id="constructor-and-initializer">Constructor and initializer<a class="anchor" aria-label="anchor" href="#constructor-and-initializer"></a>
</h2>
<ul>
<li><p><strong>Constructor</strong> is responsible for creating and initializing an object.</p></li>
<li><p><strong>Initializer</strong> is responsible for running codes on the object after the object has been built.</p></li>
</ul>
<p>Therefore, initializer can only be run after the constructor. Conventionally, user input will be taken by the initializer.</p>
</div>
<div class="section level2">
<h2 id="self">
<code>self</code><a class="anchor" aria-label="anchor" href="#self"></a>
</h2>
<p>There is nothing special about <code>self</code>. It is just a conventional name used inside the body of method to refer to an object itself.</p>
</div>
</div>
<div class="section level1">
<h1 id="visage-oop-system">
<code>visage</code> OOP system<a class="anchor" aria-label="anchor" href="#visage-oop-system"></a>
</h1>
<p><code>visage</code> OOP system builds upon the R language feature - “environment”. For more details about this language feature, please check the R Documentation <code><a href="https://rdrr.io/r/base/environment.html" class="external-link">help(environment)</a></code>.</p>
<p>Every <code>visage</code> class and instance are environments with S3 class <code>visage_oop</code>. For example, the <code>BASE</code> class provided by the package is an environment.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tengmcing.github.io/visage/" class="external-link">visage</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">BASE</span><span class="op">)</span>
<span class="co">#&gt; Class 'visage_oop' &lt;environment: 0x7fa5a8a2dcb0&gt;</span></code></pre></div>
<div class="section level2">
<h2 id="define-a-new-class">Define a new class<a class="anchor" aria-label="anchor" href="#define-a-new-class"></a>
</h2>
<p>To define a new class, we need to use the function <code><a href="../reference/new_class.html">new_class()</a></code> with a class name passed to the <code>class_name</code> argument. The output shows that it is an unknown object. This is because the S3 method <code>print.visage_oop</code> can not find the <code>..str..()</code> method from the class. Similar to <code>__str__()</code> in Python, <code>..str..()</code> is responsible for providing a nicely printable string representation of an object. We will elaborate this behaviour in section ?.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span>class_name <span class="op">=</span> <span class="st">"DEMO"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── &lt;DEMO class&gt;</span></code></pre></div>
<p>If no environment is provided to <code><a href="../reference/new_class.html">new_class()</a></code> via argument <code>env</code>, then it will automatically new an environment with the current environment as the parent environment.</p>
<p>So, if <code><a href="../reference/new_class.html">new_class()</a></code> is run in the global environment, then the parent environment of the <code>DEMO</code> class is the global environment.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">parent.env</a></span><span class="op">(</span><span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span>class_name <span class="op">=</span> <span class="st">"DEMO"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></code></pre></div>
<p>And if <code><a href="../reference/new_class.html">new_class()</a></code> is run in an environment associated with a function, then the parent environment of the <code>DEMO</code> class is that environment.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">parent.env</a></span><span class="op">(</span><span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span>class_name <span class="op">=</span> <span class="st">"DEMO"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: 0x7fa598214548&gt;</span>
<span class="co">#&gt; &lt;environment: 0x7fa598214548&gt;</span></code></pre></div>
<p>If an environment is provided via <code>env</code>, <code><a href="../reference/new_class.html">new_class()</a></code> will adopt that environment as <code>DEMO</code> class.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: 0x7fa5998620e0&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">e</span>, class_name <span class="op">=</span> <span class="st">"DEMO"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Class 'visage_oop' &lt;environment: 0x7fa5998620e0&gt;</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="define-methods">Define methods<a class="anchor" aria-label="anchor" href="#define-methods"></a>
</h2>
<p>You may notice that the basic usage of <code><a href="../reference/new_class.html">new_class()</a></code> only provides a class with very few attributes. Let’s explore the structure of the <code>DEMO</code> class with <code><a href="https://lobstr.r-lib.org/reference/tree.html" class="external-link">lobstr::tree</a></code>. According to the result, the class only contains three attributes, a character vector <code>..class..</code> representing the class list, a string <code>..type..</code> representing the type and a Boolean value <code>..instantiated..</code> representing the instantiated state.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DEMO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span>class_name <span class="op">=</span> <span class="st">"DEMO"</span><span class="op">)</span>
<span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/tree.html" class="external-link">tree</a></span><span class="op">(</span><span class="va">DEMO</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: 0x7fa5983cbf68&gt;</span>
<span class="co">#&gt; ├─..dict..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..str..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..len..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..class..&lt;chr [2]&gt;: <span style="color: #0000BB;">"DEMO", "BASE"</span></span>
<span class="co">#&gt; ├─..new..: <span style="font-style: italic;">function(env, init_call)</span></span>
<span class="co">#&gt; ├─..repr..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─has_attr: <span style="font-style: italic;">function(attr_name)</span></span>
<span class="co">#&gt; ├─instantiation: <span style="font-style: italic;">function(..., env)</span></span>
<span class="co">#&gt; ├─set_attr: <span style="font-style: italic;">function(attr_name, attr_val)</span></span>
<span class="co">#&gt; ├─..type..: <span style="color: #0000BB;">"DEMO"</span></span>
<span class="co">#&gt; ├─get_attr: <span style="font-style: italic;">function(attr_name)</span></span>
<span class="co">#&gt; ├─..methods..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..method_env..: &lt;environment: 0x7fa5983d9a28&gt;</span>
<span class="co">#&gt; │ └─self: &lt;environment: 0x7fa5983cbf68&gt; (Already seen)</span>
<span class="co">#&gt; ├─..instantiated..: <span style="color: #0000BB;">FALSE</span></span>
<span class="co">#&gt; └─..init..: <span style="font-style: italic;">function(...)</span></span></code></pre></div>
<p>It does not have any methods, nor any mechanism to run methods. To define some methods for this empty class, we need to use <code><a href="../reference/register_method.html">register_method()</a></code>.</p>
<p>Here, we tell the function we want to register a method called <code>myfunc</code> in the environment <code>DEMO</code>, and the method <code>myfunc</code> is a copy of the function <code>foo</code>. Then, the method can be called by <code>DEMO$myfunc()</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="st">"Hello, world!"</span>

<span class="va">foo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">a</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/register_method.html">register_method</a></span><span class="op">(</span><span class="va">DEMO</span>, myfunc <span class="op">=</span> <span class="va">foo</span><span class="op">)</span>

<span class="va">DEMO</span><span class="op">$</span><span class="fu">myfunc</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "Hello, world!"</span></code></pre></div>
<p>It seems like <code>register_method</code> only makes a copy of the function <code>foo</code> and stores it in <code>DEMO</code>. But it does more than that. If we check the structure again we will see <code>DEMO</code> now contains another environment called <code>..method_env..</code>, which contains an environment <code>self</code> that is identical to <code>DEMO</code>. You may ask what is the point of having this complex structure.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/tree.html" class="external-link">tree</a></span><span class="op">(</span><span class="va">DEMO</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: 0x7fa5983cbf68&gt;</span>
<span class="co">#&gt; ├─..dict..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..str..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..len..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─myfunc: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..class..&lt;chr [2]&gt;: <span style="color: #0000BB;">"DEMO", "BASE"</span></span>
<span class="co">#&gt; ├─..new..: <span style="font-style: italic;">function(env, init_call)</span></span>
<span class="co">#&gt; ├─..repr..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─has_attr: <span style="font-style: italic;">function(attr_name)</span></span>
<span class="co">#&gt; ├─instantiation: <span style="font-style: italic;">function(..., env)</span></span>
<span class="co">#&gt; ├─set_attr: <span style="font-style: italic;">function(attr_name, attr_val)</span></span>
<span class="co">#&gt; ├─..type..: <span style="color: #0000BB;">"DEMO"</span></span>
<span class="co">#&gt; ├─get_attr: <span style="font-style: italic;">function(attr_name)</span></span>
<span class="co">#&gt; ├─..methods..: <span style="font-style: italic;">function()</span></span>
<span class="co">#&gt; ├─..method_env..: &lt;environment: 0x7fa5983d9a28&gt;</span>
<span class="co">#&gt; │ └─self: &lt;environment: 0x7fa5983cbf68&gt; (Already seen)</span>
<span class="co">#&gt; ├─..instantiated..: <span style="color: #0000BB;">FALSE</span></span>
<span class="co">#&gt; └─..init..: <span style="font-style: italic;">function(...)</span></span></code></pre></div>
<p>Most R functions need to associate with a certain environment, such that values of variables can be determined. For example, the associated environment of <code>foo</code> is the global environment. So if <code>foo</code> can not find the variable <code>a</code> from the current scope, it can try to find it from the global scope.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">foo</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></code></pre></div>
<p>The environment associated with the method <code>myfunc</code> is <code>..method_env..</code>. Using the same logic, when <code>myfunc</code> can not find a variable, it will try to find that variable in <code>..method_env..</code> first, then in the parent environment of <code>..method_env..</code>, etc.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">DEMO</span><span class="op">$</span><span class="va">..method_env..</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: 0x7fa5983d9a28&gt;</span>
<span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">DEMO</span><span class="op">$</span><span class="va">myfunc</span><span class="op">)</span>
<span class="co">#&gt; &lt;environment: 0x7fa5983d9a28&gt;</span></code></pre></div>
<p>This enables us to define class method or instance method. Consider the following code chunk. We define a method <code>add_one</code> that needs to access a variable <code>self</code>. Since <code>self</code> can not be found in the current scope, the function will try to find it in <code>..method_env..</code>, where <code>self</code> is a reference to <code>DEMO</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DEMO</span><span class="op">$</span><span class="va">inc</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="va">add_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">self</span><span class="op">$</span><span class="va">inc</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">inc</span> <span class="op">+</span> <span class="fl">1</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/register_method.html">register_method</a></span><span class="op">(</span><span class="va">DEMO</span>, add_one <span class="op">=</span> <span class="va">add_1</span><span class="op">)</span></code></pre></div>
<p>Therefore, when the method <code>add_one()</code> is called, <code>DEMO$inc</code> will increase by 1.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DEMO</span><span class="op">$</span><span class="fu">add_one</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">DEMO</span><span class="op">$</span><span class="va">inc</span><span class="op">)</span>
<span class="co">#&gt; [1] 2</span>

<span class="va">DEMO</span><span class="op">$</span><span class="fu">add_one</span><span class="op">(</span><span class="op">)</span>
<span class="va">DEMO</span><span class="op">$</span><span class="va">inc</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Weihao Li.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
